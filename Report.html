<!DOCTYPE html>

<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="mobile-web-app-capable" content="yes">
    <title>
        CIA Lab 2 - Booting 2 + OS Arch - HackMD
    </title>
    <link rel="icon" type="image/png" href="https://hackmd.io/favicon.png">
    <link rel="apple-touch-icon" href="https://hackmd.io/apple-touch-icon.png">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/ionicons/2.0.1/css/ionicons.min.css" integrity="sha256-3iu9jgsy9TpTwXKb7bNQzqWekRX7pPK+2OLj3R922fo=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/octicons/3.5.0/octicons.min.css" integrity="sha256-QiWfLIsCT02Sdwkogf6YMiQlj4NE84MKkzEMkZnMGdg=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.5.1/themes/prism.min.css" integrity="sha256-vtR0hSWRc3Tb26iuN2oZHt3KRUomwTufNIf5/4oeCyg=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@hackmd/emojify.js@2.1.0/dist/css/basic/emojify.min.css" integrity="sha256-UOrvMOsSDSrW6szVLe8ZDZezBxh5IoIfgTwdNDgTjiU=" crossorigin="anonymous" />
    <style>
        @import url(https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,500,500i|Source+Code+Pro:300,400,500|Source+Sans+Pro:300,300i,400,400i,600,600i|Source+Serif+Pro&subset=latin-ext);.hljs{display:block;background:#fff;padding:.5em;color:#333;overflow-x:auto}.hljs-comment,.hljs-meta{color:#969896}.hljs-emphasis,.hljs-quote,.hljs-string,.hljs-strong,.hljs-template-variable,.hljs-variable{color:#df5000}.hljs-keyword,.hljs-selector-tag,.hljs-type{color:#a71d5d}.hljs-attribute,.hljs-bullet,.hljs-literal,.hljs-number,.hljs-symbol{color:#0086b3}.hljs-built_in,.hljs-builtin-name{color:#005cc5}.hljs-name,.hljs-section{color:#63a35c}.hljs-tag{color:#333}.hljs-attr,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-id,.hljs-selector-pseudo,.hljs-title{color:#795da3}.hljs-addition{color:#55a532;background-color:#eaffea}.hljs-deletion{color:#bd2c00;background-color:#ffecec}.hljs-link{text-decoration:underline}.markdown-body{font-size:16px;line-height:1.5;word-wrap:break-word}.markdown-body:after,.markdown-body:before{display:table;content:""}.markdown-body:after{clear:both}.markdown-body>:first-child{margin-top:0!important}.markdown-body>:last-child{margin-bottom:0!important}.markdown-body a:not([href]){color:inherit;text-decoration:none}.markdown-body .absent{color:#c00}.markdown-body .anchor{float:left;padding-right:4px;margin-left:-20px;line-height:1}.markdown-body .anchor:focus{outline:none}.markdown-body blockquote,.markdown-body dl,.markdown-body ol,.markdown-body p,.markdown-body pre,.markdown-body table,.markdown-body ul{margin-top:0;margin-bottom:16px}.markdown-body hr{height:.25em;padding:0;margin:24px 0;background-color:#e7e7e7;border:0}.markdown-body blockquote{font-size:16px;padding:0 1em;color:#777;border-left:.25em solid #ddd}.markdown-body blockquote>:first-child{margin-top:0}.markdown-body blockquote>:last-child{margin-bottom:0}.markdown-body kbd,.popover kbd{display:inline-block;padding:3px 5px;font-size:11px;line-height:10px;color:#555;vertical-align:middle;background-color:#fcfcfc;border:1px solid #ccc;border-bottom-color:#bbb;border-radius:3px;box-shadow:inset 0 -1px 0 #bbb}.markdown-body .loweralpha{list-style-type:lower-alpha}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin-top:24px;margin-bottom:16px;font-weight:600;line-height:1.25}.markdown-body h1 .octicon-link,.markdown-body h2 .octicon-link,.markdown-body h3 .octicon-link,.markdown-body h4 .octicon-link,.markdown-body h5 .octicon-link,.markdown-body h6 .octicon-link{color:#000;vertical-align:middle;visibility:hidden}.markdown-body h1:hover .anchor,.markdown-body h2:hover .anchor,.markdown-body h3:hover .anchor,.markdown-body h4:hover .anchor,.markdown-body h5:hover .anchor,.markdown-body h6:hover .anchor{text-decoration:none}.markdown-body h1:hover .anchor .octicon-link,.markdown-body h2:hover .anchor .octicon-link,.markdown-body h3:hover .anchor .octicon-link,.markdown-body h4:hover .anchor .octicon-link,.markdown-body h5:hover .anchor .octicon-link,.markdown-body h6:hover .anchor .octicon-link{visibility:visible}.markdown-body h1 code,.markdown-body h1 tt,.markdown-body h2 code,.markdown-body h2 tt,.markdown-body h3 code,.markdown-body h3 tt,.markdown-body h4 code,.markdown-body h4 tt,.markdown-body h5 code,.markdown-body h5 tt,.markdown-body h6 code,.markdown-body h6 tt{font-size:inherit}.markdown-body h1{font-size:2em}.markdown-body h1,.markdown-body h2{padding-bottom:.3em;border-bottom:1px solid #eee}.markdown-body h2{font-size:1.5em}.markdown-body h3{font-size:1.25em}.markdown-body h4{font-size:1em}.markdown-body h5{font-size:.875em}.markdown-body h6{font-size:.85em;color:#777}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol.no-list,.markdown-body ul.no-list{padding:0;list-style-type:none}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:0;margin-bottom:0}.markdown-body li>p{margin-top:16px}.markdown-body li+li{padding-top:.25em}.markdown-body dl{padding:0}.markdown-body dl dt{padding:0;margin-top:16px;font-size:1em;font-style:italic;font-weight:700}.markdown-body dl dd{padding:0 16px;margin-bottom:16px}.markdown-body table{display:block;width:100%;overflow:auto;word-break:normal;word-break:keep-all}.markdown-body table th{font-weight:700}.markdown-body table td,.markdown-body table th{padding:6px 13px;border:1px solid #ddd}.markdown-body table tr{background-color:#fff;border-top:1px solid #ccc}.markdown-body table tr:nth-child(2n){background-color:#f8f8f8}.markdown-body img{max-width:100%;box-sizing:content-box;background-color:#fff}.markdown-body img[align=right]{padding-left:20px}.markdown-body img[align=left]{padding-right:20px}.markdown-body .emoji{max-width:none;vertical-align:text-top;background-color:transparent}.markdown-body span.frame{display:block;overflow:hidden}.markdown-body span.frame>span{display:block;float:left;width:auto;padding:7px;margin:13px 0 0;overflow:hidden;border:1px solid #ddd}.markdown-body span.frame span img{display:block;float:left}.markdown-body span.frame span span{display:block;padding:5px 0 0;clear:both;color:#333}.markdown-body span.align-center{display:block;overflow:hidden;clear:both}.markdown-body span.align-center>span{display:block;margin:13px auto 0;overflow:hidden;text-align:center}.markdown-body span.align-center span img{margin:0 auto;text-align:center}.markdown-body span.align-right{display:block;overflow:hidden;clear:both}.markdown-body span.align-right>span{display:block;margin:13px 0 0;overflow:hidden;text-align:right}.markdown-body span.align-right span img{margin:0;text-align:right}.markdown-body span.float-left{display:block;float:left;margin-right:13px;overflow:hidden}.markdown-body span.float-left span{margin:13px 0 0}.markdown-body span.float-right{display:block;float:right;margin-left:13px;overflow:hidden}.markdown-body span.float-right>span{display:block;margin:13px auto 0;overflow:hidden;text-align:right}.markdown-body code,.markdown-body tt{padding:0;padding-top:.2em;padding-bottom:.2em;margin:0;font-size:85%;background-color:rgba(0,0,0,.04);border-radius:3px}.markdown-body code:after,.markdown-body code:before,.markdown-body tt:after,.markdown-body tt:before{letter-spacing:-.2em;content:"\00a0"}.markdown-body code br,.markdown-body tt br{display:none}.markdown-body del code{text-decoration:inherit}.markdown-body pre{word-wrap:normal}.markdown-body pre>code{padding:0;margin:0;font-size:100%;word-break:normal;white-space:pre;background:transparent;border:0}.markdown-body .highlight{margin-bottom:16px}.markdown-body .highlight pre{margin-bottom:0;word-break:normal}.markdown-body .highlight pre,.markdown-body pre{padding:16px;overflow:auto;font-size:85%;line-height:1.45;background-color:#f7f7f7;border-radius:3px}.markdown-body pre code,.markdown-body pre tt{display:inline;max-width:auto;padding:0;margin:0;overflow:visible;line-height:inherit;word-wrap:normal;background-color:transparent;border:0}.markdown-body pre code:after,.markdown-body pre code:before,.markdown-body pre tt:after,.markdown-body pre tt:before{content:normal}.markdown-body .csv-data td,.markdown-body .csv-data th{padding:5px;overflow:hidden;font-size:12px;line-height:1;text-align:left;white-space:nowrap}.markdown-body .csv-data .blob-line-num{padding:10px 8px 9px;text-align:right;background:#fff;border:0}.markdown-body .csv-data tr{border-top:0}.markdown-body .csv-data th{font-weight:700;background:#f8f8f8;border-top:0}.news .alert .markdown-body blockquote{padding:0 0 0 40px;border:0 none}.activity-tab .news .alert .commits,.activity-tab .news .markdown-body blockquote{padding-left:0}.task-list-item{list-style-type:none}.task-list-item label{font-weight:400}.task-list-item.enabled label{cursor:pointer}.task-list-item+.task-list-item{margin-top:3px}.task-list-item-checkbox{float:left;margin:.31em 0 .2em -1.3em!important;vertical-align:middle;cursor:default!important}.markdown-body{padding-top:40px;padding-bottom:40px;max-width:758px;overflow:visible!important;position:relative}.markdown-body .emoji{vertical-align:top}.markdown-body pre{border:inherit!important}.markdown-body code{color:inherit!important}.markdown-body pre code .wrapper{display:-moz-inline-flex;display:-ms-inline-flex;display:-o-inline-flex;display:inline-flex}.markdown-body pre code .gutter{float:left;overflow:hidden;-webkit-user-select:none;user-select:none}.markdown-body pre code .gutter.linenumber{text-align:right;position:relative;display:inline-block;cursor:default;z-index:4;padding:0 8px 0 0;min-width:20px;box-sizing:content-box;color:#afafaf!important;border-right:3px solid #6ce26c!important}.markdown-body pre code .gutter.linenumber>span:before{content:attr(data-linenumber)}.markdown-body pre code .code{float:left;margin:0 0 0 16px}.markdown-body .gist .line-numbers{border-left:none;border-top:none;border-bottom:none}.markdown-body .gist .line-data{border:none}.markdown-body .gist table{border-spacing:0;border-collapse:inherit!important}.markdown-body code[data-gist-id]{background:none;padding:0}.markdown-body code[data-gist-id]:after,.markdown-body code[data-gist-id]:before{content:""}.markdown-body code[data-gist-id] .blob-num{border:unset}.markdown-body code[data-gist-id] table{overflow:unset;margin-bottom:unset}.markdown-body code[data-gist-id] table tr{background:unset}.markdown-body[dir=rtl] pre{direction:ltr}.markdown-body[dir=rtl] code{direction:ltr;unicode-bidi:embed}.markdown-body .alert>p{margin-bottom:0}.markdown-body pre.abc,.markdown-body pre.flow-chart,.markdown-body pre.graphviz,.markdown-body pre.mermaid,.markdown-body pre.sequence-diagram,.markdown-body pre.vega{text-align:center;background-color:inherit;border-radius:0;white-space:inherit;overflow:visible}.markdown-body pre.abc>code,.markdown-body pre.flow-chart>code,.markdown-body pre.graphviz>code,.markdown-body pre.mermaid>code,.markdown-body pre.sequence-diagram>code,.markdown-body pre.vega>code{text-align:left}.markdown-body pre.abc>svg,.markdown-body pre.flow-chart>svg,.markdown-body pre.graphviz>svg,.markdown-body pre.mermaid>svg,.markdown-body pre.sequence-diagram>svg,.markdown-body pre.vega>svg{max-width:100%;height:100%}.markdown-body pre>code.wrap{white-space:pre-wrap;white-space:-moz-pre-wrap;white-space:-pre-wrap;white-space:-o-pre-wrap;word-wrap:break-word}.markdown-body .alert>p,.markdown-body .alert>ul{margin-bottom:0}.markdown-body summary{display:list-item}.markdown-body summary:focus{outline:none}.markdown-body details summary{cursor:pointer}.markdown-body details:not([open])>:not(summary){display:none}.markdown-body figure{margin:1em 40px}.markdown-body .mark,.markdown-body mark{background-color:#fff1a7}.vimeo,.youtube{cursor:pointer;display:table;text-align:center;background-position:50%;background-repeat:no-repeat;background-size:contain;background-color:#000;overflow:hidden}.vimeo,.youtube{position:relative;width:100%}.youtube{padding-bottom:56.25%}.vimeo img{width:100%;object-fit:contain;z-index:0}.youtube img{object-fit:cover;z-index:0}.vimeo iframe,.youtube iframe,.youtube img{width:100%;height:100%;position:absolute;top:0;left:0}.vimeo iframe,.youtube iframe{vertical-align:middle;z-index:1}.vimeo .icon,.youtube .icon{position:absolute;height:auto;width:auto;top:50%;left:50%;transform:translate(-50%,-50%);color:#fff;opacity:.3;transition:opacity .2s;z-index:0}.vimeo:hover .icon,.youtube:hover .icon{opacity:.6;transition:opacity .2s}.slideshare .inner,.speakerdeck .inner{position:relative;width:100%}.slideshare .inner iframe,.speakerdeck .inner iframe{position:absolute;top:0;bottom:0;left:0;right:0;width:100%;height:100%}.figma{display:table;position:relative;width:100%;padding-bottom:56.25%}.figma iframe{position:absolute;top:0;bottom:0;left:0;right:0;width:100%;height:100%;border:1px solid #eee}.MJX_Assistive_MathML{display:none}#MathJax_Message{z-index:1000!important}.ui-infobar{position:relative;z-index:2;max-width:760px;margin:25px auto -25px;color:#777}.toc .invisable-node{list-style-type:none}.ui-toc{position:fixed;bottom:20px;z-index:998}.ui-toc.both-mode{margin-left:8px}.ui-toc.both-mode .ui-toc-label{height:40px;padding:10px 4px;border-top-left-radius:0;border-bottom-left-radius:0}.ui-toc-label{background-color:#e6e6e6;border:none;color:#868686;transition:opacity .2s}.ui-toc .open .ui-toc-label{opacity:1;color:#fff;transition:opacity .2s}.ui-toc-label:focus{opacity:.3;background-color:#ccc;color:#000}.ui-toc-label:hover{opacity:1;background-color:#ccc;transition:opacity .2s}.ui-toc-dropdown{margin-top:20px;margin-bottom:20px;padding-left:10px;padding-right:10px;max-width:45vw;width:25vw;max-height:70vh;overflow:auto;text-align:inherit}.ui-toc-dropdown>.toc{max-height:calc(70vh - 100px);overflow:auto}.ui-toc-dropdown[dir=rtl] .nav{padding-right:0;letter-spacing:.0029em}.ui-toc-dropdown a{overflow:hidden;text-overflow:ellipsis;white-space:pre}.ui-toc-dropdown .nav>li>a{display:block;padding:4px 20px;font-size:13px;font-weight:500;color:#767676}.ui-toc-dropdown .nav>li:first-child:last-child>ul,.ui-toc-dropdown .toc.expand ul{display:block}.ui-toc-dropdown .nav>li>a:focus,.ui-toc-dropdown .nav>li>a:hover{padding-left:19px;color:#000;text-decoration:none;background-color:transparent;border-left:1px solid #000}.ui-toc-dropdown[dir=rtl] .nav>li>a:focus,.ui-toc-dropdown[dir=rtl] .nav>li>a:hover{padding-right:19px;border-left:none;border-right:1px solid #000}.ui-toc-dropdown .nav>.active:focus>a,.ui-toc-dropdown .nav>.active:hover>a,.ui-toc-dropdown .nav>.active>a{padding-left:18px;font-weight:700;color:#000;background-color:transparent;border-left:2px solid #000}.ui-toc-dropdown[dir=rtl] .nav>.active:focus>a,.ui-toc-dropdown[dir=rtl] .nav>.active:hover>a,.ui-toc-dropdown[dir=rtl] .nav>.active>a{padding-right:18px;border-left:none;border-right:2px solid #000}.ui-toc-dropdown .nav .nav{display:none;padding-bottom:10px}.ui-toc-dropdown .nav>.active>ul{display:block}.ui-toc-dropdown .nav .nav>li>a{padding-top:1px;padding-bottom:1px;padding-left:30px;font-size:12px;font-weight:400}.ui-toc-dropdown[dir=rtl] .nav .nav>li>a{padding-right:30px}.ui-toc-dropdown .nav .nav>li>ul>li>a{padding-top:1px;padding-bottom:1px;padding-left:40px;font-size:12px;font-weight:400}.ui-toc-dropdown[dir=rtl] .nav .nav>li>ul>li>a{padding-right:40px}.ui-toc-dropdown .nav .nav>li>a:focus,.ui-toc-dropdown .nav .nav>li>a:hover{padding-left:29px}.ui-toc-dropdown[dir=rtl] .nav .nav>li>a:focus,.ui-toc-dropdown[dir=rtl] .nav .nav>li>a:hover{padding-right:29px}.ui-toc-dropdown .nav .nav>li>ul>li>a:focus,.ui-toc-dropdown .nav .nav>li>ul>li>a:hover{padding-left:39px}.ui-toc-dropdown[dir=rtl] .nav .nav>li>ul>li>a:focus,.ui-toc-dropdown[dir=rtl] .nav .nav>li>ul>li>a:hover{padding-right:39px}.ui-toc-dropdown .nav .nav>.active:focus>a,.ui-toc-dropdown .nav .nav>.active:hover>a,.ui-toc-dropdown .nav .nav>.active>a{padding-left:28px;font-weight:500}.ui-toc-dropdown[dir=rtl] .nav .nav>.active:focus>a,.ui-toc-dropdown[dir=rtl] .nav .nav>.active:hover>a,.ui-toc-dropdown[dir=rtl] .nav .nav>.active>a{padding-right:28px}.ui-toc-dropdown .nav .nav>.active>.nav>.active:focus>a,.ui-toc-dropdown .nav .nav>.active>.nav>.active:hover>a,.ui-toc-dropdown .nav .nav>.active>.nav>.active>a{padding-left:38px;font-weight:500}.ui-toc-dropdown[dir=rtl] .nav .nav>.active>.nav>.active:focus>a,.ui-toc-dropdown[dir=rtl] .nav .nav>.active>.nav>.active:hover>a,.ui-toc-dropdown[dir=rtl] .nav .nav>.active>.nav>.active>a{padding-right:38px}.markdown-body{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica Neue,Helvetica,Roboto,Arial,sans-serif}html[lang^=ja] .markdown-body{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica Neue,Helvetica,Roboto,Arial,Hiragino Kaku Gothic Pro,ヒラギノ角ゴ Pro W3,Osaka,Meiryo,メイリオ,MS Gothic,ＭＳ\ ゴシック,sans-serif}html[lang=zh-tw] .markdown-body{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica Neue,Helvetica,Roboto,Arial,PingFang TC,Microsoft JhengHei,微軟正黑,sans-serif}html[lang=zh-cn] .markdown-body{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica Neue,Helvetica,Roboto,Arial,PingFang SC,Microsoft YaHei,微软雅黑,sans-serif}html .markdown-body[lang^=ja]{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica Neue,Helvetica,Roboto,Arial,Hiragino Kaku Gothic Pro,ヒラギノ角ゴ Pro W3,Osaka,Meiryo,メイリオ,MS Gothic,ＭＳ\ ゴシック,sans-serif}html .markdown-body[lang=zh-tw]{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica Neue,Helvetica,Roboto,Arial,PingFang TC,Microsoft JhengHei,微軟正黑,sans-serif}html .markdown-body[lang=zh-cn]{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica Neue,Helvetica,Roboto,Arial,PingFang SC,Microsoft YaHei,微软雅黑,sans-serif}html[lang^=ja] .ui-toc-dropdown{font-family:Source Sans Pro,Helvetica,Arial,Meiryo UI,MS PGothic,ＭＳ\ Ｐゴシック,sans-serif}html[lang=zh-tw] .ui-toc-dropdown{font-family:Source Sans Pro,Helvetica,Arial,Microsoft JhengHei UI,微軟正黑UI,sans-serif}html[lang=zh-cn] .ui-toc-dropdown{font-family:Source Sans Pro,Helvetica,Arial,Microsoft YaHei UI,微软雅黑UI,sans-serif}html .ui-toc-dropdown[lang^=ja]{font-family:Source Sans Pro,Helvetica,Arial,Meiryo UI,MS PGothic,ＭＳ\ Ｐゴシック,sans-serif}html .ui-toc-dropdown[lang=zh-tw]{font-family:Source Sans Pro,Helvetica,Arial,Microsoft JhengHei UI,微軟正黑UI,sans-serif}html .ui-toc-dropdown[lang=zh-cn]{font-family:Source Sans Pro,Helvetica,Arial,Microsoft YaHei UI,微软雅黑UI,sans-serif}.ui-affix-toc{position:fixed;top:0;max-width:15vw;max-height:70vh;overflow:auto}.back-to-top,.expand-toggle,.go-to-bottom{display:block;padding:4px 10px;margin-top:10px;margin-left:10px;font-size:12px;font-weight:500;color:#999}.back-to-top:focus,.back-to-top:hover,.expand-toggle:focus,.expand-toggle:hover,.go-to-bottom:focus,.go-to-bottom:hover{color:#563d7c;text-decoration:none}.back-to-top,.go-to-bottom{margin-top:0}.ui-user-icon{width:20px;height:20px;display:block;border-radius:50%;margin-top:2px;margin-bottom:2px;margin-right:5px;background-position:50%;background-repeat:no-repeat;background-size:cover}.ui-user-icon.small{width:18px;height:18px;display:inline-block;vertical-align:middle;margin:0 0 .2em}.ui-infobar>small>span{line-height:22px}.ui-infobar>small .dropdown{display:inline-block}.ui-infobar>small .dropdown a:focus,.ui-infobar>small .dropdown a:hover{text-decoration:none}.ui-more-info{color:#888;cursor:pointer;vertical-align:middle}.ui-more-info .fa{font-size:16px}.ui-connectedGithub,.ui-published-note{color:#888}.ui-connectedGithub{line-height:23px;white-space:nowrap}.ui-connectedGithub a.file-path{color:#888;text-decoration:none;padding-left:22px}.ui-connectedGithub a.file-path:active,.ui-connectedGithub a.file-path:hover{color:#888;text-decoration:underline}.ui-connectedGithub .fa{font-size:20px}.ui-published-note .fa{font-size:20px;vertical-align:top}.unselectable{-webkit-user-select:none;-o-user-select:none;user-select:none}.selectable{-webkit-user-select:text;-o-user-select:text;user-select:text}@media print{blockquote,div,img,pre,table{page-break-inside:avoid!important}a[href]:after{font-size:12px!important}}.markdown-body.slides{position:relative;z-index:1;color:#222}.markdown-body.slides:before{content:"";display:block;position:absolute;top:0;left:0;right:0;bottom:0;z-index:-1;background-color:currentColor;box-shadow:0 0 0 50vw}.markdown-body.slides section[data-markdown]{position:relative;margin-bottom:1.5em;background-color:#fff;text-align:center}.markdown-body.slides section[data-markdown] code{text-align:left}.markdown-body.slides section[data-markdown]:before{content:"";display:block;padding-bottom:56.23%}.markdown-body.slides section[data-markdown]>div:first-child{position:absolute;top:50%;left:1em;right:1em;transform:translateY(-50%);max-height:100%;overflow:hidden}.markdown-body.slides section[data-markdown]>ul{display:inline-block}.markdown-body.slides>section>section+section:after{content:"";position:absolute;top:-1.5em;right:1em;height:1.5em;border:3px solid #777}.site-ui-font{font-family:Source Sans Pro,Helvetica,Arial,sans-serif}html[lang^=ja] .site-ui-font{font-family:Source Sans Pro,Helvetica,Arial,Hiragino Kaku Gothic Pro,ヒラギノ角ゴ Pro W3,Osaka,Meiryo,メイリオ,MS Gothic,ＭＳ\ ゴシック,sans-serif}html[lang=zh-tw] .site-ui-font{font-family:Source Sans Pro,Helvetica,Arial,PingFang TC,Microsoft JhengHei,微軟正黑,sans-serif}html[lang=zh-cn] .site-ui-font{font-family:Source Sans Pro,Helvetica,Arial,PingFang SC,Microsoft YaHei,微软雅黑,sans-serif}body{font-smoothing:subpixel-antialiased!important;-webkit-font-smoothing:subpixel-antialiased!important;-moz-osx-font-smoothing:auto!important;text-shadow:0 0 1em transparent,1px 1px 1.2px rgba(0,0,0,.004);-webkit-overflow-scrolling:touch;letter-spacing:.025em;font-family:Source Sans Pro,Helvetica,Arial,sans-serif}html[lang^=ja] body{font-family:Source Sans Pro,Helvetica,Arial,Hiragino Kaku Gothic Pro,ヒラギノ角ゴ Pro W3,Osaka,Meiryo,メイリオ,MS Gothic,ＭＳ\ ゴシック,sans-serif}html[lang=zh-tw] body{font-family:Source Sans Pro,Helvetica,Arial,PingFang TC,Microsoft JhengHei,微軟正黑,sans-serif}html[lang=zh-cn] body{font-family:Source Sans Pro,Helvetica,Arial,PingFang SC,Microsoft YaHei,微软雅黑,sans-serif}abbr[title]{border-bottom:none;text-decoration:underline;-webkit-text-decoration:underline dotted;text-decoration:underline dotted}abbr[data-original-title],abbr[title]{cursor:help}body.modal-open{overflow-y:auto;padding-right:0!important}
    </style>
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    	<script src="https://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv.min.js" integrity="sha256-3Jy/GbSLrg0o9y5Z5n1uw0qxZECH7C6OQpVBgNFYa0g=" crossorigin="anonymous"></script>
    	<script src="https://cdnjs.cloudflare.com/ajax/libs/respond.js/1.4.2/respond.min.js" integrity="sha256-g6iAfvZp+nDQ2TdTR/VVKJf3bGro4ub5fvWSWVRi2NE=" crossorigin="anonymous"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/es5-shim/4.5.9/es5-shim.min.js" integrity="sha256-8E4Is26QH0bD52WoQpcB+R/tcWQtpzlCojrybUd7Mxo=" crossorigin="anonymous"></script>
    <![endif]-->
</head>

<body>
    <div id="doc" class="markdown-body container-fluid comment-enabled comment-inner" data-hard-breaks="true"><h1 id="CIA-Lab-2---Booting-2--OS-Arch" data-id="CIA-Lab-2---Booting-2--OS-Arch"><a class="anchor hidden-xs" href="#CIA-Lab-2---Booting-2--OS-Arch" title="CIA-Lab-2---Booting-2--OS-Arch"><span class="octicon octicon-link"></span></a><span>CIA Lab 2 - Booting 2 + OS Arch</span></h1><p><strong><span>Name: Vladimir Shelkovnikov</span></strong></p><hr><h2 id="Task-1---Booting-the-OS" data-id="Task-1---Booting-the-OS"><a class="anchor hidden-xs" href="#Task-1---Booting-the-OS" title="Task-1---Booting-the-OS"><span class="octicon octicon-link"></span></a><span>Task 1 - Booting the OS</span></h2><div class="alert alert-info">
<p><span>Now that we have Ubuntu installed, we will look at the booting process.</span></p>
<ol>
<li><span>What is a UEFI OS loader and where does the Ubuntu OS loader reside on the system? Hint: See the UEFI specification.</span></li>
<li><span>Describe in order all the steps required for booting the computer (until the OS loader starts running.) Ubuntu uses the UEFI OS loader to load and run the GRUB boot loader.</span></li>
<li><span>What is the purpose of the GRUB boot loader in a UEFI system?</span></li>
<li><span>How does the Ubuntu OS loader load the GRUB boot loader?</span></li>
<li><span>Explain how the GRUB boot loader, in turn, loads and run the kernel by answering these 3 questions:</span><br>
<span>a. What type of filesystem is the kernel on?</span><br>
<span>b. What type(s) of filesystem does UEFI support?</span><br>
<span>c. What does the GRUB boot loader, therefore, have to do to load the kernel?</span></li>
<li><span>Do you need an OS loader and/or boot loader to load a Linux kernel with UEFI? Explain why or why not.</span></li>
<li><span>In an MBR-based system, the GRUB bootloader is distributed over the disk in multiple parts.</span><br>
<span>a. How many parts (or stages) does GRUB have in such a system, and what is their task?</span><br>
<span>b. Where are the different stages found on the disk?</span></li>
</ol>
</div><h2 id="Answers" data-id="Answers"><a class="anchor hidden-xs" href="#Answers" title="Answers"><span class="octicon octicon-link"></span></a><span>Answers</span></h2><div class="alert alert-info">
<p><span>What is a UEFI OS loader and where does the Ubuntu OS loader reside on the system? Hint: See the UEFI specification.</span></p>
</div><p><span>A UEFI OS loader is a special type of UEFI application. The firmware transfers control of the system to the OS loader. Once started, the OS loader continues to boot the complete operating system. To do so, it may use the EFI boot services and interfaces to survey, comprehend, and initialize the various platform components and the OS software that manages them.</span></p><p><span>The specification of UEFI provides for a variety of mass storage device types including disk, CD-ROM, and DVD as well as remote boot via a network.</span></p><p><span>There are several possible types of boot loaders.</span></p><ol>
<li><span>BIOS-based. A boot loader is stored in the first sector of a hard disk, the Master Boot Record (MBR). This may be GRUB or LILO or others.</span></li>
<li><span>UEFI. The Ubuntu OS loader is located in ESP (EFI System Partition) -/boot/efi/EFI/ubuntu</span></li>
<li><span>A boot loader is stored on some other storage device, such as a CDR or USB flash drive.</span></li>
<li><span>A boot loader that uses the network, such as the Pre-Execution Environment (PXE). This code is normally stored on a ROM on the networking card itself.</span></li>
</ol><div class="alert alert-info">
<p><span>Describe in order all the steps required for booting the computer (until the OS loader starts running.) Ubuntu uses the UEFI OS loader to load and run the GRUB boot loader.</span></p>
</div><p><span>BIOS-based:</span></p><ol>
<li><span>Power Supply &amp; SMPS.</span></li>
<li><span>Bootstrapping. The processor goes to the address FFFF:0000h. It contains the instruction </span><code>jump</code><span> to the location of the BIOS program in the ROM.</span></li>
<li><span>BIOS performs Power on Self Test (POST). POST checks and confirms the integrity of the hardware components.</span></li>
<li><span>The BIOS then loads and executes the MBR boot loader.</span></li>
<li><span>MBR loads and executes the GRUB boot loader.</span></li>
<li><span>GRUB loads and executes Kernel and </span><code>initrd</code><span> images. The </span><code>initrd images</code><span> contain the modules required for mounting the root partition. If several kernel images are installed, GRUB will ask which one you want to boot.</span></li>
<li><span>The kernel selected by GRUB first mounts the root filesystem specified in the </span><code>grub.conf</code><span>. After that, it executes the /sbin/init program.</span></li>
<li><span>Init process will look at the </span><code>/etc/inittab</code><span> to see the default run level. Once this is identified, then run level specific programs are started by the kernel.</span></li>
</ol><p><span>UEFI:</span></p><ol>
<li><span>The computer switched on. The UEFI firmware performs a POST and then locates and initializes peripheral devices.</span></li>
<li><span>The firmware reads the boot entries in the </span><code>NVRAM</code><span> to determine which EFI application (boot loader) to run and from which disk and partition. For Ubuntu, this is GRUB </span><code>/boot/efi/EFI/ubuntu/grub.efi</code><span>.</span></li>
<li><span>If there are multiple boot devices, the UEFI Boot Manager determines the appropriate ESC (EFI System Partition) to use according to the order defined in the boot manager.</span></li>
<li><span>The UEFI boot manager checks whether Secure Boot is enabled. If it is not enabled, the Boot Manager runs the GRUB on the ESP. Otherwise, the boot manager requests a certificate from the boot loader and checks it for compliance with the keys stored in the UEFI secure boot key database. If the certificate is valid, the boot loader runs and, in turn, validates the kernel that it is configured to load.</span></li>
<li><span>The boot loader loads the </span><code>vmlinuz</code><span> kernel image file into memory and extracts the contents of the initramfs image file into a temporary, memory-based file system (tmpfs).</span></li>
<li><span>The kernel loads the driver modules from the initramfs file system that are needed to access the root file system.</span></li>
<li><span>The kernel starts the </span><code>systemd</code><span> process.</span></li>
<li><code>systemd</code><span> runs any additions processes defined for it.</span></li>
</ol><div class="alert alert-info">
<p><span>What is the purpose of the GRUB boot loader in a UEFI system?</span></p>
</div><p><span>The purpose of the GRUB is to take over from BIOS at boot time, load itself, load the Linux kernel into memory, and then pass execution to the kernel. Once the kernel takes over, GRUB has done its job and it is no longer needed. GRUB supports multiple Linux kernels and allows the user to select between them at boot time using a menu.</span></p><div class="alert alert-info">
<p><span>How does the Ubuntu OS loader load the GRUB boot loader?</span></p>
</div><p><span>UEFI. The firmware reads the boot entries in the NVRAM to determine which EFI application (boot loader) to run and from which disk and partition (/boot/efi).</span></p><p><span>BIOS. GRUB replaces the default MBR with its code. This code points to the secondary boot loader (stage 2) that is located somewhere on the disk. Stage 2 points to the configuration file, which contains all of the complex user interface and options.</span></p><div class="alert alert-info">
<p><span>Explain how the GRUB boot loader, in turn, loads and run the kernel by answering these 3 questions:</span><br>
<span>a. What type of filesystem is the kernel on?</span><br>
<span>b. What type(s) of filesystem does UEFI support?</span><br>
<span>c. What does the GRUB boot loader, therefore, have to do to load the kernel?</span></p>
</div><p><span>There are two ways to exchange data at once. The first of them is a virtual file system (VFS). With the help of this type of FS, the kernel and applications installed in the system work together. VFS allows the user to work without taking into account the features of each specific FS. The second method is file system drivers. They are responsible for the connection between hardware and software.</span><br>
<span>The list of file systems supported by the Linux kernel is located in the file </span><code>/proc/filesystems</code><span>.</span><br>
<span>The proc file system (procfs) acts as an interface to internal data structures in the kernel. It can be used to obtain information about the system and to change certain kernel parameters at runtime (</span><code>sysctl</code><span>). In addition, the </span><code>sysfs</code><span> file system builds relationships between the kernel and the hardware.</span></p><p><span>The file system supported by the EFI is based on the FAT file system. EFI includes the use of FAT32 for the system partition and FAT12 or FAT16 for removable media. It also uses the ISO9660 for CD/DVD discs.</span></p><p><span>After loading itself, GRUB executes the grub_main function. The grub_main function initializes the console, gets the base address for modules, sets the root device, loads the grub configuration file, etc. At the end of execution, the grub_main function moves grub to normal mode. The grub_normal_execute function completes the final preparations and shows a menu to select an OS. When one of the grub menu entries has been selected, the grub_menu_execute_entry function is launched, which executes the grub boot command and booting the selected OS.</span></p><div class="alert alert-info">
<p><span>Do you need an OS loader and/or boot loader to load a Linux kernel with UEFI? Explain why or why not</span></p>
</div><p><span>There is EFISTUB in UEFI. This provides the ability to boot the kernel directly from the UEFI motherboard or indirectly using the bootloader. But since the EFI boot stub perfoms the job of boot loader, it is the boot loader.</span></p><div class="alert alert-info">
<p><span>In an MBR-based system, the GRUB bootloader is distributed over the disk in multiple parts.</span><br>
<span>a. How many parts (or stages) does GRUB have in such a system, and what is their task?</span><br>
<span>b. Where are the different stages found on the disk?</span></p>
</div><p><span>GRUB has stages 1, 1.5, 2.</span></p><p><span>The first stage (boot.img) is located at MBR (bootstrap code area) and points to stage 2. The second stage loads the kernel and other initrd image files.</span></p><p><span>Stage 1.5 is located on the free space between the MBR and the beginning of the partitions (MBR Gap). It contains the drivers for reading file systems.</span></p><h2 id="Task-2---Initializing-the-OS" data-id="Task-2---Initializing-the-OS"><a class="anchor hidden-xs" href="#Task-2---Initializing-the-OS" title="Task-2---Initializing-the-OS"><span class="octicon octicon-link"></span></a><span>Task 2 - Initializing the OS</span></h2><div class="alert alert-info">
<p><span>Describe the entire startup process of Ubuntu in the default installation. The subquestions below are leaders to help you along, they must be answered but by no means represent the entire startup process of Ubuntu. . .</span><br>
<span>a. What is the first process started by the kernel?</span><br>
<span>b. Where is the configuration kept for the started process?</span><br>
<span>c. It starts multiple processes. How is the order of execution defined?</span><br>
<span>d. …</span></p>
</div><h2 id="Answer" data-id="Answer"><a class="anchor hidden-xs" href="#Answer" title="Answer"><span class="octicon octicon-link"></span></a><span>Answer</span></h2><p><span>The first process started by kernel is </span><code>systemd</code><span> (/lib/systemd/systemd). In older Linux distributions, the first process is </span><code>init</code><span> (/sbin/init). Its role is to initialize the system environment as defined in link </span><code>/lib/systemd/system/default.target</code><span> and the configuration files in </span><code>/etc/systemd/system/</code><span> and </span><code>/lib/systemd/system/</code><span>.</span></p><p><span>Each task is divided into small ones (units).</span><br>
<code>Systemd</code><span> runs services in parallel. </span><code>Systemd</code><span> uses </span><code>Cgroups</code><span> to execute and track processes. </span><code>Systemd</code><span> starts each process in its assigned control group (Cgroup). If the number of processes in a particular group is reduced to 0, then </span><code>Systemd</code><span> understands that the process has been terminated (possibly in an emergency), and can start it again if necessary.</span><br>
<span>After the systemd determines the default.target and its dependencies, it activates the dependent processes and the target.</span><br>
<span>Then the system can respond to system events and activate additional components.</span></p><p><span>Figure 1 shows the general sequence of events during systemd startup and the basic ordering requirements to ensure a successful startup.</span></p><center>
<p><img src="https://i.imgur.com/uNNZgPg.png" alt="" loading="lazy"><br>
<span>Figure 1 - The general sequence of events during systemd startup (Source: bootup man)</span></p>
</center><h2 id="Task-3---Basic-OS-interaction" data-id="Task-3---Basic-OS-interaction"><a class="anchor hidden-xs" href="#Task-3---Basic-OS-interaction" title="Task-3---Basic-OS-interaction"><span class="octicon octicon-link"></span></a><span>Task 3 - Basic OS interaction</span></h2><div class="alert alert-info">
<h4 id="Binaries-and-scripts" data-id="Binaries-and-scripts"><a class="anchor hidden-xs" href="#Binaries-and-scripts" title="Binaries-and-scripts"><span class="octicon octicon-link"></span></a><span>Binaries and scripts</span></h4>
<p><span>Make a table listing five different binaries or interpreter scripts, and their type (Hint: use</span><br>
<span>the “file” command in “/usr/bin”)</span></p>
<h4 id="Tracing-binaries" data-id="Tracing-binaries"><a class="anchor hidden-xs" href="#Tracing-binaries" title="Tracing-binaries"><span class="octicon octicon-link"></span></a><span>Tracing binaries</span></h4>
<ol>
<li><span>Read the “strace” man page.</span></li>
<li><span>Use “strace” to find what other systems call besides “stat” “zsh” uses before executing an “execve” system call to start a given binary (e.g. “/bin/ls”)? (Hint: use the “-c” option of “zsh”)</span></li>
</ol>
<h4 id="Stracing-strace" data-id="Stracing-strace"><a class="anchor hidden-xs" href="#Stracing-strace" title="Stracing-strace"><span class="octicon octicon-link"></span></a><span>Stracing strace</span></h4>
<ol>
<li><span>Run “strace /bin/pwd” and save the result</span></li>
<li><span>Also run “strace strace /bin/pwd” and save the result. How are these outputs related? Explain the “2” in “write(2, …”.</span></li>
</ol>
<h4 id="ELF-format" data-id="ELF-format"><a class="anchor hidden-xs" href="#ELF-format" title="ELF-format"><span class="octicon octicon-link"></span></a><span>ELF format</span></h4>
<ol>
<li><span>Read the “readelf” man page. Make sure you make your terminal as wide a possible.</span></li>
<li><span>Execute </span><code>readelf -Wh ssh</code><span>. Match the results for the ELF header with the information on ELF’s Wikipedia page. Is this a definitive source for the ELF format? If not, what is?</span></li>
<li><span>Also inspect the section and program headers, using the command </span><code>readelf -WlS ssh</code><span>.</span><br>
<span>a. Explain which of the two header types (section or program) is used in which context (loader/runtime or linker/relocation)?</span><br>
<span>b. Explain the use of each of the following sections: .text, .data, .rodata and .bss. (Hint: Consider Type and Flg)</span><br>
<span>c. What does the program header with Type INTERP contain?</span></li>
<li><span>Read your favorite ELF binary with hexdump utility.</span><br>
<span>a. show the virtual address and physical address.</span><br>
<span>b. show/explain the entry point of the ELF binary.</span></li>
<li><span>Find the loaded libraries of your shell by executing </span><code>lsof -p $</code><span>. Also, look at the memory image of your shell by executing </span><code>cat /proc/$/maps</code><span>. Why is for instance the libc library mapped into memory multiple times?</span></li>
</ol>
</div><h3 id="Implementation" data-id="Implementation"><a class="anchor hidden-xs" href="#Implementation" title="Implementation"><span class="octicon octicon-link"></span></a><span>Implementation</span></h3><div class="alert alert-info">
<h4 id="Binaries-and-script" data-id="Binaries-and-script"><a class="anchor hidden-xs" href="#Binaries-and-script" title="Binaries-and-script"><span class="octicon octicon-link"></span></a><span>Binaries and script</span></h4>
<p><span>Make a table listing five different binaries or interpreter scripts, and their type (Hint: use the “file” command in “/usr/bin”)</span></p>
</div><p><span>Figure 2 shows a list of five different binary files and interpreter scripts, as well as their type.</span></p><center>
<p><img src="https://i.imgur.com/yDoK403.png" alt="" loading="lazy"><br>
<span>Figure 2 - List of binary files and interpreter scripts and their type</span></p>
</center><div class="alert alert-info" data-original-title="" title="">
<h4 id="Tracing-binaries1" data-id="Tracing-binaries"><a class="anchor hidden-xs" href="#Tracing-binaries1" title="Tracing-binaries1"><span class="octicon octicon-link"></span></a><span>Tracing binaries</span></h4>
<ol>
<li><span>Read the “strace” man page.</span></li>
<li><span>Use “strace” to find what other systems call besides “stat” “zsh” uses before executing an “execve” system call to start a given binary (e.g. “/bin/ls”)? (Hint: use the “-c” option of “zsh”)</span></li>
</ol>
</div><p><span>I used the command </span><code>strace zsh -c /bin/ls</code><span> to find other system calls besides </span><code>stat</code><span> that </span><code>zsh</code><span> uses. Figure 3 shows the result.</span></p><center>
<p><img src="https://i.imgur.com/GfbNNLj.png" alt="" loading="lazy"><br>
<span>Figure 3 - </span><code>strace zsh -c /bin/ls</code></p>
</center><p><span>First, the required libraries are loaded. Then it checks the available privilege and accesses the input/output devices (</span><code>ioctl</code><span>). pts is started and a </span><code>pipe</code><span> is created, where the command streams will be redirected using the </span><code>dup</code><span> system call. Then it receives the system information. </span><code>prlimit64</code><span> sets the limits. The </span><code>dup</code><span>s are closed. </span><code>rt_sigaction</code><span> change a signal actions and </span><code>rt_sigprocmask</code><span> change blocked signals. </span><code>Zsh</code><span> loads the configuration files. </span><code>/dev/null</code><span> is being loaded. </span><code>/dev/null</code><span> is being closed. </span><code>execve (/bin/ls)</code><span> starts.</span></p><div class="alert alert-info" data-original-title="" title="">
<h4 id="Stracing-strace1" data-id="Stracing-strace"><a class="anchor hidden-xs" href="#Stracing-strace1" title="Stracing-strace1"><span class="octicon octicon-link"></span></a><span>Stracing strace</span></h4>
<ol>
<li><span>Run “strace /bin/pwd” and save the result</span></li>
<li><span>Also run “strace strace /bin/pwd” and save the result. How are these outputs related? Explain the “2” in “write(2, …</span></li>
</ol>
</div><p><span>I run </span><code>strace /bin/pwd</code><span> and save the result as </span><code>pwd</code><span>. Then I saved the result of </span><code>strace strace /bin/pwd</code><span> as </span><code>strace_pwd</code><span>.</span></p><p><span>The </span><code>strace -o strace_pwd strace /bin/pwd</code><span> command includes the initialization of </span><code>strace</code><span> and the result of </span><code>strace -o pwd /bin/pwd</code><span>.</span></p><p><span>2 in write(2,…) is the second file descriptor. It is called </span><code>STDERR</code><span> and is used by applications to output data that reports an error.</span></p><div class="alert alert-info">
<h4 id="ELF-format1" data-id="ELF-format"><a class="anchor hidden-xs" href="#ELF-format1" title="ELF-format1"><span class="octicon octicon-link"></span></a><span>ELF format</span></h4>
<p><span>Execute “readelf -Wh &lt;</span>&lt;your favorite ELF binary&gt;<span>&gt;”. Match the results for the ELF header with the information on ELF’s Wikipedia page. Is this a definitive source for the ELF format? If not, what is?</span></p>
</div><p><code>readelf</code><span> is a program that displays information about ELF files.</span></p><p><span>-W - Don’t break output lines to fit into 80 columns.</span></p><p><span>-h - Displays the information contained in the ELF header at the start of the file.</span></p><p><span>Figure 4 shows the result of </span><code>readelf -Wh</code><span>.</span></p><center>
<p><img src="https://i.imgur.com/wYwBQBS.png" alt="" loading="lazy"><br>
<span>Figure 4 - </span><code>readelf -Wh</code></p>
</center><p><span>My result is similar to the file header on the ELF’s Wikipedia page. It contains information for executing and identifying the ELF file. But some hex fields are missing.</span></p><div class="alert alert-info">
<p><span>Also inspect the section and program headers, using the command “readelf -WlS &lt;</span>&lt;your favorite ELF binary&gt;<span>&gt;”.</span></p>
<p><span>Explain which of the two header types (section or program) is used in which context (loader/runtime or linker/relocation)?</span></p>
</div><p><span>Figure 5 shows the section header. Figure 6 shows the program header.</span></p><center>
<p><img src="https://i.imgur.com/H5Q7gNf.png" alt="" loading="lazy"><br>
<span>Figure 5 - Section header</span></p>
<p><img src="https://i.imgur.com/7mVarJu.png" alt="" loading="lazy"><br>
<span>Figure 6 - Programm header</span></p>
</center><p><span>Program header table, required for loadable files, and optional for relocatable files. The ELF file consists of zero or more segments and describes how to create a process, a memory image for execution in runtime. When the kernel sees these segments, it places them in the virtual address space using the </span><code>mmap</code><span> system call.</span></p><p><span>The section headers define all sections of the file. This information is used for linking and relocation.</span></p><p><span>ELF files are intended for execution and linking. Depending on the purpose, they contain the necessary segments and sections. The OS kernel scans the segments and maps them to memory (using </span><code>mmap</code><span>). Sections are viewed by a linker that creates an executable file or a shared object.</span></p><div class="alert alert-info">
<p><span>Explain the use of each of the following sections: .text, .data, .rodata and .bss. (Hint: Consider Type and Flg)</span></p>
</div><p><span>.text contains executable code with read and execute permissions (SHF_ALLOC + SHF_EXECINSTR). Type = 0x1 (SHT_PROGBITS).</span><br>
<span>.data contains initialized data, with read and write permissions (SHF_ALLOC + SHF_WRITE). Type = 0x1 (SHT_PROGBITS).</span><br>
<span>.rodata contains initialized data, with read-only rights. Type = 0x1 (SHT_PROGBITS)</span><br>
<span>.bss contains uninitialized data with read and write permissions(SHF_ALLOC + SHF_WRITE). Type = 0x8 SHT_NOBITS.</span></p><div class="alert alert-info">
<p><span>What does the program header with Type INTERP contain?</span></p>
</div><p><span>The program header with the type INTERP contains the location of the segment where the name of the program interpreter may be found.</span></p><div class="alert alert-info">
<p><span>Read your favorite ELF binary with hexdump utility.</span><br>
<span>a. show the virtual address and physical address.</span><br>
<span>b. show/explain the entry point of the ELF binary.</span></p>
</div><p><span>A physical address is the address of a cell in RAM.</span><br>
<span>A virtual address is the address of a cell in the program.</span><br>
<span>Figure 7 shows the program header table.</span></p><center>
<p><img src="https://i.imgur.com/X72p4PB.png" alt="" loading="lazy"><br>
<span>Figure 7 - Program header table</span></p>
</center><p><span>0600 0000 - Reserved inclusive range. Operating system-specific.</span><br>
<span>0400 0000 - flags.</span><br>
<span>4000 0000 0000 0000 (64) - offset where it should be read.</span><br>
<span>4000 0000 0000 0000 (64) - virtual address.</span><br>
<span>4000 0000 0000 0000 (64) - physical address.</span><br>
<span>d802 0000 0000 0000 (728) - size on file.</span><br>
<span>d802 0000 0000 0000 (728) - size in memory.</span><br>
<span>0800 0000 0000 0000 (8) - align.</span></p><p><span>The entry point is the memory address from which the program execution begins.</span><br>
<span>Figure 8 shows the ELF header.</span></p><center>
<p><img src="https://i.imgur.com/JjrWNqq.png" alt="" loading="lazy"><br>
<span>Figure 8 - The ELF Header</span></p>
</center><p><span>000e 0100 0000 0000 (69120) - entry point</span></p><div class="alert alert-info">
<p><span>Find the loaded libraries of your shell by executing </span><code>lsof -p $</code><span>. Also, look at the memory image of your shell by executing </span><code>cat /proc/$/maps</code><span>. Why is for instance the libc library mapped into memory multiple times?</span></p>
</div><p><span>Figure 9 shows the loaded libraries (directory /usr/lib/*) and file descriptors (0, 1, 2, 255).</span></p><center>
<p><img src="https://i.imgur.com/Ya0qxeP.png" alt="" loading="lazy"><br>
<span>Figure 9 - </span><code>lsof -p $</code></p>
</center><p><span>Figure 10 shows a memory image of a shell.</span></p><center>
<p><img src="https://i.imgur.com/rHnzAOr.png" alt="" loading="lazy"><br>
<span>Figure 10 - Memory image of shell</span></p>
</center><p><span>In Figure 10, we can see that the repeated mapping actually corresponds to a different mappings with a different permissions. First, it map the library systemwide (read-only) and then maps it to the virtual memory address space of each required process.</span></p><h2 id="Task-4---The-gcc-compiler" data-id="Task-4---The-gcc-compiler"><a class="anchor hidden-xs" href="#Task-4---The-gcc-compiler" title="Task-4---The-gcc-compiler"><span class="octicon octicon-link"></span></a><span>Task 4 - The gcc compiler</span></h2><div class="alert alert-info">
<p><span>Let us consider “Hello SNE!” - program:</span></p>
<pre><code>    #include &lt;stdio.h&gt;
    int main(int argc, char *argv[])
    {
     printf("Hello SNE!\n");
     return 2021;
     /* What is the actual exit status? Why? */
    }
</code></pre>
<h4 id="Make-your-own-version-of-the-“Hello-SNE”-program-by-just-only-varying-the-string-Can-you-come-up-with-a-creative-text-Find-all-four-phases-in-the-compilation-by-running-gcc--v--o-hello-helloc" data-id="Make-your-own-version-of-the-“Hello-SNE”-program-by-just-only-varying-the-string-Can-you-come-up-with-a-creative-text-Find-all-four-phases-in-the-compilation-by-running-gcc--v--o-hello-helloc"><a class="anchor hidden-xs" href="#Make-your-own-version-of-the-“Hello-SNE”-program-by-just-only-varying-the-string-Can-you-come-up-with-a-creative-text-Find-all-four-phases-in-the-compilation-by-running-gcc--v--o-hello-helloc" title="Make-your-own-version-of-the-“Hello-SNE”-program-by-just-only-varying-the-string-Can-you-come-up-with-a-creative-text-Find-all-four-phases-in-the-compilation-by-running-gcc--v--o-hello-helloc"><span class="octicon octicon-link"></span></a><span>Make your own version of the “Hello SNE!”-program, by just only varying the string. Can you come up with a creative text? Find all four phases in the compilation by running </span><code>gcc -v -o hello hello.c</code><span>.</span></h4>
<p><span>Now we are going to do all the stages separately in order to inspect the different</span><br>
<span>intermediate steps:</span></p>
<ol>
<li><span>Run </span><code>gcc -E hello.c -o hello.i</code><span>, producing the file “hello.i”.</span><br>
<span>What are the numbers at the end of the lines in “hello.i” supposed to mean?</span></li>
<li><span>Run </span><code>gcc -S hello.i</code><span>, producing the file “hello.s”</span><br>
<span>Inspect “hello.s”. Where has </span><code>printf</code><span> gone?</span><br>
<span>Remove the newline at the end of the string in “hello.c” and look again at the resulting “hello.s”. Explain.</span></li>
<li><span>Run </span><code>gcc -c hello.s</code><span>, producing the file “hello.o”.</span><br>
<span>Use </span><code>objdump -rd hello.o</code><span> to inspect this relocatable object file.</span><br>
<span>Explain why this piece of machine code is (not yet) executable.</span></li>
<li><span>Run </span><code>gcc -o hello hello.o</code><span>, producing the file “hello”.</span><br>
<span>Use </span><code>trace ./hello</code><span> to see what library calls your program makes.</span><br>
<span>Run </span><code>ltrace -S</code><span> to also see the system calls.</span><br>
<span>What is the actual exit code of your program? Can you explain this?</span><br>
<span>Remark: You can generate all the intermediate files at once by using the “-save-temps”</span><br>
<span>option of “gcc”</span></li>
</ol>
</div><h2 id="Implementation1" data-id="Implementation"><a class="anchor hidden-xs" href="#Implementation1" title="Implementation1"><span class="octicon octicon-link"></span></a><span>Implementation</span></h2><p><span>It returns the exit status of 229, because we set the return to 2021, while the max is 255 (2021 mod 256 = 229).</span></p><div class="alert alert-info">
<p><span>What are the numbers at the end of the lines in “hello.i” supposed to mean?</span></p>
</div><p><span>These numbers are flags:</span><br>
<span>1 - start a new file;</span><br>
<span>2 - go back to the file;</span><br>
<span>3 - the following text is taken from the system header file, so some warnings should be suppressed;</span><br>
<span>4 - the following text should be considered as enclosed in an implicit external block “C”.</span></p><div class="alert alert-info">
<p><span>Where has </span><code>printf</code><span> gone?</span></p>
</div><p><span>The compiler replaced </span><code>printf</code><span> with </span><code>puts</code><span> because gcc analyzes and optimizes the code.</span></p><div class="alert alert-info">
<p><span>Explain why this piece of machine code is (not yet) executable</span></p>
</div><p><code>.o</code><span> is an object file. We need to link it to make an executable file. Also, it doesn’t have an entry point.</span></p><p><span>Figure 11 shows the result of </span><code>ltrace ./programm</code><span>.</span></p><center>
<p><img src="https://i.imgur.com/7w7PfT9.png" alt="" loading="lazy"><br>
<span>Figure 11 - First result of ltrace</span></p>
</center><p><span>There is no library call here. So I changed the command and got the result shown in Figure 12.</span></p><center>
<p><img src="https://i.imgur.com/t62EHx9.png" alt="" loading="lazy"><br>
<span>Figure 12 - Second result of ltrace</span></p>
</center><p><span>There is one library call </span><code>__print_chk</code><span>. Figure 13 shows result of </span><code>ltace -S ./progamm</code><span>.</span></p><center>
<p><img src="https://i.imgur.com/mp8hx39.png" alt="" loading="lazy"><br>
<span>Figure 13 - System calls</span></p>
</center><p><span>My actual exit code is 0 because the program is successfully executed. There is an exit status 21 because the program returns 21.</span></p><h2 id="Task-5---Stripped-and-non-stripped-binaries" data-id="Task-5---Stripped-and-non-stripped-binaries"><a class="anchor hidden-xs" href="#Task-5---Stripped-and-non-stripped-binaries" title="Task-5---Stripped-and-non-stripped-binaries"><span class="octicon octicon-link"></span></a><span>Task 5 - Stripped and non-stripped binaries</span></h2><div class="alert alert-info">
<ol>
<li><span>Breifly explain what is stripped and non-stripped baniries and write at least two pros and cons.</span></li>
<li><span>Compile the below code in two versions e.g. stripped and non-stripped and prove your above explanation.</span></li>
</ol>
<pre><code class="#include hljs"><span class="hljs-function"><span class="hljs-built_in">int</span> <span class="hljs-title">main</span>(<span class="hljs-params"><span class="hljs-built_in">int</span> argc, <span class="hljs-built_in">char</span> *argv[]</span>)</span>
{
   printf(<span class="hljs-string">"Stripped and non-stripped test\n"</span>);
   <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<ol start="3">
<li><span>Can you find entry point in a stripped binary file, if so, use a debug tool and find</span><br>
<span>the entry point of the previously compiled stripped file. If no, why?</span></li>
</ol>
</div><h2 id="Implementation2" data-id="Implementation"><a class="anchor hidden-xs" href="#Implementation2" title="Implementation2"><span class="octicon octicon-link"></span></a><span>Implementation</span></h2><p><span>Non-stripped binaries include debugging information (symbols) and tend to be larger in size. This information can be used to disassemble programs, but it can also help in finding bugs.</span></p><p><span>Whereas strip binaries generally remove these symbols from the file which is not necessary for execution to reduce the size of the executable file. If it is used incorrectly, it can also delete other data (source </span><code>man strip</code><span>)</span><br>
<span>Figure 14 shows the size of files and information about them.</span></p><center>
<p><img src="https://i.imgur.com/3WOOTiF.png" alt="" loading="lazy"></p>
<p><span>Figure 14 - Information about files</span></p>
</center><p><span>We can still see the entry point in the ELF header, but if we use gdb, there is no symbolic information about it.</span></p><h2 id="Task-6---The-file-descriptor" data-id="Task-6---The-file-descriptor"><a class="anchor hidden-xs" href="#Task-6---The-file-descriptor" title="Task-6---The-file-descriptor"><span class="octicon octicon-link"></span></a><span>Task 6 - The file descriptor</span></h2><div class="alert alert-info">
<p><span>Now we will look at the different file descriptors and learn what happens when a process opens a file.</span></p>
<ol>
<li><span>Explain why we need file descriptors?</span></li>
<li><span>What is a file descriptor table in a process and what items it holds?</span></li>
<li><span>list file descriptors of your current bash session.</span></li>
<li><span>Where are the locations of file descriptor (linux)?</span></li>
<li><span>Write a code that creates a file and print the default file descriptors index and pointers in the file descriptor table of the process.</span></li>
</ol>
<h4 id="Redirecting-file-descriptors" data-id="Redirecting-file-descriptors"><a class="anchor hidden-xs" href="#Redirecting-file-descriptors" title="Redirecting-file-descriptors"><span class="octicon octicon-link"></span></a><span>Redirecting file descriptors.</span></h4>
<p><span>Briefly explain and provide at least two examples of redirecting file descriptors i.e run a command (E.g. find / -name ‘</span><em><span>something</span></em><span>’) and redirect the file descriptor.</span></p>
</div><h2 id="Implementation3" data-id="Implementation"><a class="anchor hidden-xs" href="#Implementation3" title="Implementation3"><span class="octicon octicon-link"></span></a><span>Implementation</span></h2><p><span>When the file was opened, the operating system created an entry point to represent this file and store information about it. This provides greater performance because the usage of multiple system calls takes more time.</span></p><p><span>Each running process has a file descriptor table. It contains pointers to all open input/output streams.</span><br>
<span>Figure 15 shows the list of file descriptors of the current bash session.</span></p><center>
<p><img src="https://i.imgur.com/Z7bTNcC.png" alt="" loading="lazy"><br>
<span>Figure 15 - List of file descriptors</span></p>
</center><p><span>There are following file descriptors:</span><br>
<span>0 - STDIN - is associated with data input;</span><br>
<span>1 - STDOUT - is used to output data;</span><br>
<span>2 - STDERR - is used to output data that reports an error;</span><br>
<span>255 - is opened for bash’s own needs</span></p><p><span>The process file descriptor will be saved in the </span><code>/proc/&lt;PID&gt;/fd</code><span> section.</span></p><p><span>Figure 16 shows output redirection.</span></p><center>
<p><img src="https://i.imgur.com/ZRupZeo.png" alt="" loading="lazy"><br>
<span>Figure 16 - Output redirection</span></p>
</center><p><span>This redirects the output of the </span><code>find</code><span> command to a file called </span><code>r.txt</code><span>.</span></p><p><span>Figure 17 shows the usage of a single file descriptor to read and write.</span></p><center>
<p><img src="https://i.imgur.com/ZOc5KUH.png" alt="" loading="lazy"><br>
<span>Figure 17 - Using a Single File Descriptor to Read And Write</span></p>
</center><p><span>First, the file </span><code>second.txt</code><span> was opened for both input and output in the file descriptor 12. Then the two output streams were redirected to fd 12. When I </span><code>cat</code><span> the file, I see that both output streams have been written to the file.</span><br>
<span>When I try to read from a file, it returns nothing, because fb 12 points to the end of the file after the last character of the last output stream.</span></p><hr><h2 id="References" data-id="References"><a class="anchor hidden-xs" href="#References" title="References"><span class="octicon octicon-link"></span></a><span>References</span></h2><ol>
<li><a href="https://uefi.org/sites/default/files/resources/UEFI_Spec_2_9_2021_03_18.pdf" target="_blank" rel="noopener"><span>UEFI Specification</span></a></li>
<li><a href="https://www.freecodecamp.org/news/the-linux-booting-process-6-steps-described-in-detail/" target="_blank" rel="noopener"><span>The Linux Booting Process (BIOS)</span></a></li>
<li><a href="https://linoxide.com/initrd-image-linux" target="_blank" rel="noopener"><span>What is Initrd Image?</span></a></li>
<li><a href="https://docs.oracle.com/en/operating-systems/oracle-linux/8/osmanage/ol-bootconf.html#ol-bootconf-about" target="_blank" rel="noopener"><span>About the Boot Process</span></a></li>
<li><a href="https://www.dedoimedo.com/computers/grub.html" target="_blank" rel="noopener"><span>GRUB bootloader - Full tutorial</span></a></li>
<li><a href="https://www.kernel.org/doc/html/latest/filesystems/index.html" target="_blank" rel="noopener"><span>Filesystems in the Linux kernel</span></a></li>
<li><a href="https://0xax.github.io/grub/" target="_blank" rel="noopener"><span>How does GNU GRUB work</span></a></li>
<li><a href="https://0xax.gitbooks.io/linux-insides/content/Booting/linux-bootstrap-1.html" target="_blank" rel="noopener"><span>Kernel booting process</span></a></li>
<li><a href="https://wiki.archlinux.org/title/EFISTUB" target="_blank" rel="noopener"><span>EFISTUB</span></a></li>
<li><a href="https://www.kernel.org/doc/html/latest/admin-guide/efi-stub.html" target="_blank" rel="noopener"><span>The EFI Boot Stub</span></a></li>
<li><a href="https://man7.org/linux/man-pages/man7/bootup.7.html" target="_blank" rel="noopener"><span>bootup man</span></a></li>
<li><a href="https://uclibc.org/docs/elf-64-gen.pdf" target="_blank" rel="noopener"><span>ELF Specification</span></a></li>
<li><a href="https://en.wikipedia.org/wiki/Executable_and_Linkable_Format" target="_blank" rel="noopener"><span>Executable and Linkable Format</span></a></li>
<li><a href="https://gcc.gnu.org/onlinedocs/cpp/Preprocessor-Output.html" target="_blank" rel="noopener"><span>Preprocessor Output</span></a></li>
</ol></div>
    <div class="ui-toc dropup unselectable hidden-print" style="display:none;">
        <div class="pull-right dropdown">
            <a id="tocLabel" class="ui-toc-label btn btn-default" data-toggle="dropdown" href="#" role="button" aria-haspopup="true" aria-expanded="false" title="Table of content">
                <i class="fa fa-bars"></i>
            </a>
            <ul id="ui-toc" class="ui-toc-dropdown dropdown-menu" aria-labelledby="tocLabel">
                <div class="toc"><ul class="nav">
<li><a href="#CIA-Lab-2---Booting-2--OS-Arch" title="CIA Lab 2 - Booting 2 + OS Arch">CIA Lab 2 - Booting 2 + OS Arch</a><ul class="nav">
<li><a href="#Task-1---Booting-the-OS" title="Task 1 - Booting the OS">Task 1 - Booting the OS</a></li>
<li><a href="#Answers" title="Answers">Answers</a></li>
<li><a href="#Task-2---Initializing-the-OS" title="Task 2 - Initializing the OS">Task 2 - Initializing the OS</a></li>
<li><a href="#Answer" title="Answer">Answer</a></li>
<li><a href="#Task-3---Basic-OS-interaction" title="Task 3 - Basic OS interaction">Task 3 - Basic OS interaction</a><ul class="nav">
<li><a href="#Implementation" title="Implementation">Implementation</a></li>
</ul>
</li>
<li><a href="#Task-4---The-gcc-compiler" title="Task 4 - The gcc compiler">Task 4 - The gcc compiler</a></li>
<li><a href="#Implementation1" title="Implementation">Implementation</a></li>
<li><a href="#Task-5---Stripped-and-non-stripped-binaries" title="Task 5 - Stripped and non-stripped binaries">Task 5 - Stripped and non-stripped binaries</a></li>
<li><a href="#Implementation2" title="Implementation">Implementation</a></li>
<li><a href="#Task-6---The-file-descriptor" title="Task 6 - The file descriptor">Task 6 - The file descriptor</a></li>
<li><a href="#Implementation3" title="Implementation">Implementation</a></li>
<li><a href="#References" title="References">References</a></li>
</ul>
</li>
</ul>
</div><div class="toc-menu"><a class="expand-toggle" href="#">Expand all</a><a class="back-to-top" href="#">Back to top</a><a class="go-to-bottom" href="#">Go to bottom</a></div>
            </ul>
        </div>
    </div>
    <div id="ui-toc-affix" class="ui-affix-toc ui-toc-dropdown unselectable hidden-print" data-spy="affix" style="top:17px;display:none;" null null>
        <div class="toc"><ul class="nav">
<li><a href="#CIA-Lab-2---Booting-2--OS-Arch" title="CIA Lab 2 - Booting 2 + OS Arch">CIA Lab 2 - Booting 2 + OS Arch</a><ul class="nav">
<li><a href="#Task-1---Booting-the-OS" title="Task 1 - Booting the OS">Task 1 - Booting the OS</a></li>
<li><a href="#Answers" title="Answers">Answers</a></li>
<li><a href="#Task-2---Initializing-the-OS" title="Task 2 - Initializing the OS">Task 2 - Initializing the OS</a></li>
<li><a href="#Answer" title="Answer">Answer</a></li>
<li><a href="#Task-3---Basic-OS-interaction" title="Task 3 - Basic OS interaction">Task 3 - Basic OS interaction</a><ul class="nav">
<li><a href="#Implementation" title="Implementation">Implementation</a></li>
</ul>
</li>
<li><a href="#Task-4---The-gcc-compiler" title="Task 4 - The gcc compiler">Task 4 - The gcc compiler</a></li>
<li><a href="#Implementation1" title="Implementation">Implementation</a></li>
<li><a href="#Task-5---Stripped-and-non-stripped-binaries" title="Task 5 - Stripped and non-stripped binaries">Task 5 - Stripped and non-stripped binaries</a></li>
<li><a href="#Implementation2" title="Implementation">Implementation</a></li>
<li><a href="#Task-6---The-file-descriptor" title="Task 6 - The file descriptor">Task 6 - The file descriptor</a></li>
<li><a href="#Implementation3" title="Implementation">Implementation</a></li>
<li><a href="#References" title="References">References</a></li>
</ul>
</li>
</ul>
</div><div class="toc-menu"><a class="expand-toggle" href="#">Expand all</a><a class="back-to-top" href="#">Back to top</a><a class="go-to-bottom" href="#">Go to bottom</a></div>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js" integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gist-embed/2.6.0/gist-embed.min.js" integrity="sha256-KyF2D6xPIJUW5sUDSs93vWyZm+1RzIpKCexxElmxl8g=" crossorigin="anonymous" defer></script>
    <script>
        var markdown = $(".markdown-body");
        //smooth all hash trigger scrolling
        function smoothHashScroll() {
            var hashElements = $("a[href^='#']").toArray();
            for (var i = 0; i < hashElements.length; i++) {
                var element = hashElements[i];
                var $element = $(element);
                var hash = element.hash;
                if (hash) {
                    $element.on('click', function (e) {
                        // store hash
                        var hash = this.hash;
                        if ($(hash).length <= 0) return;
                        // prevent default anchor click behavior
                        e.preventDefault();
                        // animate
                        $('body, html').stop(true, true).animate({
                            scrollTop: $(hash).offset().top
                        }, 100, "linear", function () {
                            // when done, add hash to url
                            // (default click behaviour)
                            window.location.hash = hash;
                        });
                    });
                }
            }
        }

        smoothHashScroll();
        var toc = $('.ui-toc');
        var tocAffix = $('.ui-affix-toc');
        var tocDropdown = $('.ui-toc-dropdown');
        //toc
        tocDropdown.click(function (e) {
            e.stopPropagation();
        });

        var enoughForAffixToc = true;

        function generateScrollspy() {
            $(document.body).scrollspy({
                target: ''
            });
            $(document.body).scrollspy('refresh');
            if (enoughForAffixToc) {
                toc.hide();
                tocAffix.show();
            } else {
                tocAffix.hide();
                toc.show();
            }
            $(document.body).scroll();
        }

        function windowResize() {
            //toc right
            var paddingRight = parseFloat(markdown.css('padding-right'));
            var right = ($(window).width() - (markdown.offset().left + markdown.outerWidth() - paddingRight));
            toc.css('right', right + 'px');
            //affix toc left
            var newbool;
            var rightMargin = (markdown.parent().outerWidth() - markdown.outerWidth()) / 2;
            //for ipad or wider device
            if (rightMargin >= 133) {
                newbool = true;
                var affixLeftMargin = (tocAffix.outerWidth() - tocAffix.width()) / 2;
                var left = markdown.offset().left + markdown.outerWidth() - affixLeftMargin;
                tocAffix.css('left', left + 'px');
            } else {
                newbool = false;
            }
            if (newbool != enoughForAffixToc) {
                enoughForAffixToc = newbool;
                generateScrollspy();
            }
        }
        $(window).resize(function () {
            windowResize();
        });
        $(document).ready(function () {
            windowResize();
            generateScrollspy();
        });

        //remove hash
        function removeHash() {
            window.location.hash = '';
        }

        var backtotop = $('.back-to-top');
        var gotobottom = $('.go-to-bottom');

        backtotop.click(function (e) {
            e.preventDefault();
            e.stopPropagation();
            if (scrollToTop)
                scrollToTop();
            removeHash();
        });
        gotobottom.click(function (e) {
            e.preventDefault();
            e.stopPropagation();
            if (scrollToBottom)
                scrollToBottom();
            removeHash();
        });

        var toggle = $('.expand-toggle');
        var tocExpand = false;

        checkExpandToggle();
        toggle.click(function (e) {
            e.preventDefault();
            e.stopPropagation();
            tocExpand = !tocExpand;
            checkExpandToggle();
        })

        function checkExpandToggle () {
            var toc = $('.ui-toc-dropdown .toc');
            var toggle = $('.expand-toggle');
            if (!tocExpand) {
                toc.removeClass('expand');
                toggle.text('Expand all');
            } else {
                toc.addClass('expand');
                toggle.text('Collapse all');
            }
        }

        function scrollToTop() {
            $('body, html').stop(true, true).animate({
                scrollTop: 0
            }, 100, "linear");
        }

        function scrollToBottom() {
            $('body, html').stop(true, true).animate({
                scrollTop: $(document.body)[0].scrollHeight
            }, 100, "linear");
        }
    </script>
</body>

</html>
